
<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Metamask meta transaction test</title>
  <script>
    async function main() {
      if (!window.ethereum || !window.ethereum.isMetaMask) {
        console.log("Please install MetaMask")
        return
      }

      const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
      const chainId = await window.ethereum.request({ method: 'eth_chainId' });
      console.log(chainId);
      const eip712domain_type_definition = {
        "EIP712Domain": [
          {
            "name": "name",
            "type": "string"
          },
          {
            "name": "version",
            "type": "string"
          },
          {
            "name": "chainId",
            "type": "uint256"
          },
          {
            "name": "verifyingContract",
            "type": "address"
          }
        ]
      }
      const karma_request_domain = {
        "name": "Frequency",
        "version": "1",
        "chainId": chainId,
        "verifyingContract": "0xCcCCccccCCCCcCCCCCCcCcCccCcCCCcCcccccccC"
      }

      document.getElementById('signature_request')?.addEventListener("click", async function () {
        const signature_request = {
          "types": {
            ...eip712domain_type_definition,
			"AddKeyData": [
				{
					"name": "ownerMsaId",
					"type": "uint64"
				},
			    {
				  	"name": "expiration",
				  	"type": "uint64"
			    },
		  		{
				   	"name": "newPublicKey",
					"type": "address"
				},
			]
		  },
          "primaryType": "AddKeyData",
          "domain": karma_request_domain,
          "message": {
            "ownerMsaId": 12876327,
            "expiration": 100,
			"newPublicKey": "0x7A23F8D62589aB9651722C7F4a0E998D7d3Ef2A9"
          }
        }
        console.log(JSON.stringify({
          "method": "eth_signTypedData_v4",
          "params": [
            accounts[0],
			signature_request
          ]
        },null, 2));
        let signature = await window.ethereum.request({
          "method": "eth_signTypedData_v4",
          "params": [
            accounts[0],
			signature_request
          ]
        })
        console.log(signature);
        alert("Signature: " + signature)
      })
    }
    main()
  </script>
</head>

<body>
  <button id="signature_request">Sign</button>
</body>

</html>

<!--0x46f40c850581df7aef68cd7e0be952e97a77230eb08533f08adae105cb482e8e185d66097f79b439946f6eeec0a7112ffbf28cab3732d7062d8e2ada60c2ff3f1b-->
